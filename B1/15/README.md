<p>
이제까지 쿼리로 도큐먼트들을 조회하는 방법을 익혔었다.<br />
그리고 SQL문을 공부하는 것 처럼 쿼리의 다양한 사용법을 배웠다.<br />
하지만 쿼리 만으로는 모든 일을 해낼 수 없다.    
</p>

<p>
예를 들어서 쿼리로 조회한 도큐먼트들의 합이나 평균을 산출하는 작업은<br />
<b>집계 연산</b>의 과정을 거쳐야 한다.<br />
이번 chapter 에서는 집계 연산에 대해 공부하면서 이해한 것들을 기록하고자 한다.    
</p>

### 집계 연산의 방법

<p>
집계 연산은 MongoDB 아키텍쳐 상 어디에서 처리하느냐에 따라<br />
다음과 같이 분류할 수 있다.    
</p>

<ul>
<li>애플리케이션에서 직접 처리</li>    
<li>맵-리듀스(map-reduce)</li> 
<li>파이프라인</li> 
</ul>

<p>
아래로 향할수록 처리 속도가 빨라지는 반면에 명령어의 다양성이 떨어진다.<br />
특별한 상황이 아니라면 파이프라인 방식을 쓰는 것이 효율적일 것이다.
</p>

<p>각 방법마다 처리 속도가 차이나는 데에는<br />
거리적인, 효율적인 측면에서 이유가 있다.
</p>

<p>집계 연산을 처리한 이후에는 가공된 데이터의 양이 적어지는데,<br />
만약 집계 처리를 안한채로 보내버리면 요청 장소에서 해야할 일이 늘어나고 처리할 데이터가 무거워서<br />
효율성이 떨어진다. App 내에서의 처리 방식이 바로 그 예시이다.
</p>

<p>
후의 공부를 위해 MongoDB의 아키텍쳐 구조를 통해 
집계 처리의 과정을 살펴보자.
</p>

<img src="https://github.com/TaekGeunLee/study_MongoDB/blob/master/readmeImg/B1_15-1.png" alt="B1_15-1" />

<p>본격적으로 들어가기 전에 아키텍쳐들을 둘러보자.</p>

<ul>
   <li>
    저장소(storge)로는 일반 기억 장소, 장기 기억 장소가 존재한다.<br />
    데이터를 삽입(insert)할 때 바로 일반 기억 장소로 가고 마는 것이 아니라
    서서히 장기 기억 장소로 옮겨간다.<br />이는 MongoDB에 문제가 생겼을 때의 대비책으로,
    만약 그런 상황이 발생했을 경우 장기 기억소에 담겨진 데이터들은 보존된다. 
   </li>
   <li>
    App과 DB를 연결하여 쓰는 경우 App의 데이터 열람 요청은 MongoDB 내의 네트워크 프로토콜을 
    통해 이루어진다. 
   </li>
   <li>MongoDB의 쿼리 처리기는 JS 엔진으로 구성되어있다. 아직 엔진이 정확하게 뭔지는 몰라도 된다.</li>
</ul>

<p>
집계 연산의 과정을 훝어보면 다음과 같다.<br />
App에서 조회 명령을 MongoDB에 요청을 하면 쿼리 처리기에서 저장소 드라이버에 데이터를 가져오라고 할 것이다.<br />
저장소 드라이버가 장기 기억소로부터 데이터를 가져온 이후로 집계 연산의 과정이 시작되는데, <br />어디서 처리를 하느냐에 따라 여러 가지 방법으로 나눌 수 있을 것이다. (방법들은 위의 목록을 참조하자.)
</p>

<p>
 가장 효율적이고 빠른 방법은 파이프라인 방식이다.<br />
이 방법은 스토리지 드라이버에 가까운 곳에서 집계 연산을 한 뒤에 요청쪽인 App으로 가공한 데이터를 보낸다.
</p>

<p>
App내에서 집계 연산을 해내는 방법도 있다만, <br />App에서 처리해야 할 일이 늘어나고
집계 처리를 안한 상태의 데이터는 무겁기 때문에 부담이 된다.
</p>

<p>
여기까지 MongoDB 내에서 어떻게 집계 연산이 이루어지는지, 그리고 여러 방법들에 대해 다루었다.<br />
앞으로 디렉토리를 작성해나가면서 파이프라인, 맵-리듀스, App 내에서 직접 처리. 이 3가지 방법들을 익혀보도록 하자.
</p>